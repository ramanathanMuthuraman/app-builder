express  = require 'express'
fs       = require 'fs'
config   = require './config/config'
db = require './app/models'

app = express()

controllersPath = __dirname + '/app/controllers'
fs.readdirSync(controllersPath).forEach (file) ->
  if  file.indexOf('.coffee') >= 0
    require(controllersPath + '/' + file)(app)

require('./config/express')(app, config)

db.sequelize
  .sync()
  .complete (err) ->
    if err
      throw err[0]
    else
      app.listen(config.port);
